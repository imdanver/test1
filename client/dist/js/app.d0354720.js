(function(){var e={8474:function(e,t,s){"use strict";var a=s(9242),i=s(3396),n=s(7139);const o={class:"app"},r={class:"content"},l={class:"header"},c={class:"messages"},u={class:"footer"},m={key:0,class:"wrap"};function h(e,t,s,a,h,p){const d=(0,i.up)("app-comment"),g=(0,i.up)("app-form");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",r,[(0,i._)("div",l,[(0,i._)("div",{onClick:t[0]||(t[0]=e=>h.form=!0),class:"add"},"Добавить новый комментарий"),(0,i._)("div",{onClick:t[1]||(t[1]=(...e)=>p.sortDefault&&p.sortDefault(...e)),class:"all"},"Все комментарии"),(0,i._)("div",{onClick:t[2]||(t[2]=e=>p.sortBy("name")),class:"sort-by-name"},"Сортировать по имени"),(0,i._)("div",{onClick:t[3]||(t[3]=e=>p.sortBy("email")),class:"sort-by-email"},"Сортировать по email"),(0,i._)("div",{onClick:t[4]||(t[4]=e=>p.sortBy("ts")),class:"sort-by-date"},"Сортировать по дате")]),(0,i._)("div",c,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(p.page,(e=>((0,i.wg)(),(0,i.j4)(d,{message:e,onFormOn:p.formOn},null,8,["message","onFormOn"])))),256))]),(0,i._)("div",u,[p.pages?((0,i.wg)(),(0,i.iD)("div",m,[(0,i._)("div",null,[(0,i._)("span",{onClick:t[5]||(t[5]=e=>p.changePageNum("start")),class:"material-icons"},"more_horiz")]),(0,i._)("div",null,[(0,i._)("span",{onClick:t[6]||(t[6]=e=>p.changePageNum("minus")),class:"material-icons"},"chevron_left")]),(0,i._)("div",null,(0,n.zw)(h.pageNum),1),(0,i._)("div",null,[(0,i._)("span",{onClick:t[7]||(t[7]=e=>p.changePageNum("plus")),class:"material-icons"},"chevron_right")]),(0,i._)("div",null,[(0,i._)("span",{onClick:t[8]||(t[8]=e=>p.changePageNum("end")),class:"material-icons"},"more_horiz")])])):(0,i.kq)("",!0)]),(0,i.Wm)(g,{form:h.form,parent:h.parent,level:h.level,onFormOff:p.formOff},null,8,["form","parent","level","onFormOff"])])])}const p={class:"name-wrap"},d={class:"name"},g={class:"date"},f={class:"msg"},v=["id"],_={class:"attachment"},w=["src"],x={key:1};function y(e,t,s,a,o,r){return(0,i.wg)(),(0,i.iD)("div",{key:s.message.id,class:"message",style:(0,n.j5)({"margin-left":15+20*s.message.level+"px"})},[(0,i._)("div",p,[(0,i._)("div",d,(0,n.zw)(s.message.name),1),(0,i._)("div",g,(0,n.zw)(r.date),1)]),(0,i._)("div",f,(0,n.zw)(s.message.msg),1),s.message.ext||s.message.txt?((0,i.wg)(),(0,i.iD)("span",{key:0,onClick:t[0]||(t[0]=e=>o.attachment=!0),class:"material-icons"},"attach_file")):(0,i.kq)("",!0),o.attachment?((0,i.wg)(),(0,i.iD)("div",{key:1,class:"attachment-bg",id:s.message.uid},[(0,i._)("div",_,[s.message.ext?((0,i.wg)(),(0,i.iD)("img",{key:0,src:r.src,alt:""},null,8,w)):s.message.txt?((0,i.wg)(),(0,i.iD)("div",x,(0,n.zw)(s.message.txt),1)):(0,i.kq)("",!0),(0,i._)("span",{onClick:t[1]||(t[1]=e=>o.attachment=!1),class:"material-icons close"},"close")])],8,v)):(0,i.kq)("",!0),(0,i._)("div",{class:"answer",onClick:t[2]||(t[2]=e=>r.onClick(s.message.id,s.message.level))},"Ответить")],4)}var b={name:"Comment",props:["message"],data(){return{attachment:!1}},computed:{src(){if(this.message.ext){const e=window.location.protocol,t=window.location.hostname,s="3000";return`${e}//${t}:${s}/${this.message.uid}.${this.message.ext}`}},date(){const e=new Date(+this.message.ts),t=e.toLocaleString();return t.replace(",","")}},methods:{onClick(e,t){this.$emit("form-on",e,t)}}},k=s(89);const C=(0,k.Z)(b,[["render",y],["__scopeId","data-v-1e1dc23c"]]);var D=C,O=s.p+"img/captcha.50e85a13.jpg";const N=e=>((0,i.dD)("data-v-1111fae7"),e=e(),(0,i.Cn)(),e),$={key:0,class:"modal-overlay"},z={class:"modal"},q=N((()=>(0,i._)("label",{for:"text"},"Имя",-1))),A=N((()=>(0,i._)("label",{for:"email"},"Email",-1))),j=N((()=>(0,i._)("label",{for:"url"},"Домашняя страница",-1))),S=N((()=>(0,i._)("label",{for:"captcha"},"Капча (введите символы с изображения)",-1))),T={class:"captcha"},F=N((()=>(0,i._)("img",{src:O,alt:""},null,-1))),P=N((()=>(0,i._)("label",{for:"textarea"},"Текст сообщения",-1))),Z={class:"tags"},E=N((()=>(0,i._)("label",{for:"file"},"Загрузить файл",-1))),M={class:"errors"};function U(e,t,s,o,r,l){return s.form?((0,i.wg)(),(0,i.iD)("div",$,[(0,i._)("div",z,[(0,i._)("span",{onClick:t[0]||(t[0]=(...e)=>l.toDefault&&l.toDefault(...e)),class:"material-icons close"},"close"),(0,i._)("form",{enctype:"multipart/form-data",onSubmit:t[12]||(t[12]=(0,a.iM)((()=>{}),["prevent"]))},[q,(0,i.wy)((0,i._)("input",{type:"text",id:"text","onUpdate:modelValue":t[1]||(t[1]=e=>r.text=e)},null,512),[[a.nr,r.text]]),A,(0,i.wy)((0,i._)("input",{type:"email",id:"email","onUpdate:modelValue":t[2]||(t[2]=e=>r.email=e)},null,512),[[a.nr,r.email]]),j,(0,i.wy)((0,i._)("input",{type:"url",id:"url","onUpdate:modelValue":t[3]||(t[3]=e=>r.url=e)},null,512),[[a.nr,r.url]]),S,(0,i._)("div",T,[(0,i.wy)((0,i._)("input",{type:"text",id:"captcha","onUpdate:modelValue":t[4]||(t[4]=e=>r.captcha=e)},null,512),[[a.nr,r.captcha]]),F]),P,(0,i.wy)((0,i._)("textarea",{id:"textarea",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=e=>r.textarea=e)},null,512),[[a.nr,r.textarea]]),(0,i._)("div",Z,[(0,i._)("div",{onClick:t[6]||(t[6]=e=>l.pasteTag(0))},"[i]"),(0,i._)("div",{onClick:t[7]||(t[7]=e=>l.pasteTag(1))},"[strong]"),(0,i._)("div",{onClick:t[8]||(t[8]=e=>l.pasteTag(2))},"[code]"),(0,i._)("div",{onClick:t[9]||(t[9]=e=>l.pasteTag(3))},"[a]")]),E,(0,i._)("input",{type:"file",id:"file",onChange:t[10]||(t[10]=e=>l.upload(e))},null,32),(0,i._)("button",{onClick:t[11]||(t[11]=(...e)=>l.onSubmit&&l.onSubmit(...e))},"Отправить"),(0,i._)("div",M,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.errors,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e,class:"error"},(0,n.zw)(e),1)))),128))])],32)])])):(0,i.kq)("",!0)}s(7658);var V=s(3142),B=s(346),I=s.n(B),J={name:"AppForm",props:["form","parent","level"],data(){return{text:"Joe",email:"mymail@gmail.com",url:"https://google.com/",captcha:"captcha246",textarea:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Atque doloribus ipsa neque nesciunt odio sit totam veritatis voluptatibus. Ab alias dignissimos, dolore dolorum et illum ipsa itaque mollitia qui quod sequi veniam veritatis voluptatem. Doloremque, dolorum ea inventore natus nisi nobis odit pariatur, quae quibusdam repellendus saepe sint temporibus? Distinctio, reiciendis, veritatis? Adipisci aut error exercitationem fugit hic id, laudantium molestias necessitatibus quidem repudiandae?",file:"",errors:[],tags:["<i></i>","<strong></strong>","<code></code>",'<a href="" title=""></a>']}},mounted(){this.ws=new WebSocket("ws://45.83.122.80:4000")},methods:{pasteTag(e){this.textarea=`${this.textarea}${this.tags[e]}`},async onSubmit(){if(this.errors.length=0,this.text?/^[a-zA-Z0-9]+$/.test(this.text)||this.errors.push('Поле "Имя" может содержать только цифры и буквы латинского алфавита'):this.errors.push('Поле "Имя" должно быть заполнено'),this.email?/^[-\w.]+@([A-z0-9][-A-z0-9]+\.)+[A-z]{2,4}$/.test(this.email)||this.errors.push('Поле "Email" должно иметь формат email'):this.errors.push('Поле "Email" должно быть заполнено'),this.url&&!/^(http(s):\/\/.)[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)$/.test(this.url)&&this.errors.push('Поле "Домашняя страница" должно иметь формат url'),this.captcha?"captcha246"!==this.captcha&&this.errors.push('Поле "Капча" заполнено неправильно'):this.errors.push('Поле "Капча" должно быть заполнено'),this.textarea?/^[-?!,.<>a-z0-9а-яё@:%._+~#=/"\s”]*$/gim.test(this.textarea)||this.errors.push('Поле "Текст сообщения" содержит недопустимый символ'):this.errors.push('Поле "Текст сообщения" должно быть заполнено'),this.file){const e=["image/jpeg","image/png","image/gif","text/plain"];e.includes(this.file.type)?"text/plain"===this.file.type&&this.file.size>1e5&&this.errors.push("Размер текстового файла не должен быть более 100кб"):this.errors.push("Разрешенные типы файлов: .jpg, .png, .gif, .txt")}if(!this.errors.length){if(this.textarea=I()(this.textarea,{allowedTags:["b","i","em","strong","a"],allowedAttributes:{a:["href","title"]}}),this.file)if("text/plain"===this.file.type){const e=new FileReader;e.addEventListener("load",(e=>{const t=`user${Date.now()}`,s=e.target.result,a="";this.send(t,s,a)})),e.readAsText(this.file)}else{const e=`user${Date.now()}`,t="",s=this.file.name.split(".").pop();this.send(e,t,s);const a=new FormData;a.append("file",this.file,`${e}.${s}`),await V.Z.post(`${window.location.protocol}//${window.location.hostname}:3000/ajax`,a,{headers:{"Content-Type":"multipart/form-data"}})}else{const e=`user${Date.now()}`,t="",s="";this.send(e,t,s)}this.toDefault()}},send(e,t,s){const a={uid:e,parent:this.parent,level:this.level,name:this.text,email:this.email,url:this.url,msg:this.textarea,txt:t,ext:s,ts:Date.now()};this.ws.send(JSON.stringify(a))},toDefault(){this.$emit("form-off")},upload(e){this.file=e.target.files[0]}}};const L=(0,k.Z)(J,[["render",U],["__scopeId","data-v-1111fae7"]]);var W=L,H={name:"App",components:{AppComment:D,AppForm:W},data(){return{ws:null,comments:[],messages:[],form:!1,parent:"",level:0,order:!0,messagesCount:5,pageNum:1}},mounted(){this.ws=new WebSocket("ws://45.83.122.80:4000"),this.ws.onmessage=this.onMessage},computed:{page(){const e=(this.pageNum-1)*this.messagesCount,t=e+this.messagesCount;return this.messages.slice(e,t)},pages(){return this.messages.length>this.messagesCount}},methods:{changePageNum(e){const t=this.messages.length%this.messagesCount?Math.trunc(this.messages.length/this.messagesCount)+1:Math.trunc(this.messages.length/this.messagesCount);"start"===e?this.pageNum=1:"minus"===e?this.pageNum--:"plus"===e?this.pageNum++:"end"===e&&(this.pageNum=t),this.pageNum<1&&(this.pageNum=1),this.pageNum>t&&(this.pageNum=t)},formOn(e,t){this.parent=e,this.level=++t,this.form=!0},formOff(){this.parent="",this.level=0,this.form=!1},onMessage(e){this.comments=JSON.parse(e.data.toString()),this.sortDefault()},sortBy(e){const t=(t,s)=>{let a=t[e],i=s[e];return"ts"===e&&(a=+t[e],i=+s[e]),this.order?a>i?1:a<i?-1:0:a<i?1:a>i?-1:0},s=this.comments.filter((e=>0===+e.level));s.sort(t),this.messages=s,this.order=!this.order,this.pageNum=1},sortDefault(){let e=[],t=0;while(1){const s=this.comments.filter((e=>+e.level===t));if(!s.length)break;0===t?e=[...s]:(s.reverse(),s.forEach((t=>{const s=e.findIndex((e=>+e.id===+t.parent));-1!==s&&e.splice(+s+1,0,t)}))),t++}this.comments=e,this.messages=this.comments,this.pageNum=1}}};const K=(0,k.Z)(H,[["render",h],["__scopeId","data-v-2f501c2c"]]);var Y=K;(0,a.ri)(Y).mount("#app")},5219:function(){},9550:function(){},4029:function(){},1305:function(){},6659:function(){}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,a,i,n){if(!a){var o=1/0;for(u=0;u<e.length;u++){a=e[u][0],i=e[u][1],n=e[u][2];for(var r=!0,l=0;l<a.length;l++)(!1&n||o>=n)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(r=!1,n<o&&(o=n));if(r){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[a,i,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.p="/"}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,n,o=a[0],r=a[1],l=a[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(l)var u=l(s)}for(t&&t(a);c<o.length;c++)n=o[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(u)},a=self["webpackChunkclient"]=self["webpackChunkclient"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(8474)}));a=s.O(a)})();
//# sourceMappingURL=app.d0354720.js.map